---
layout: default
title: Fenwick Tree
nav_exclude: true
---
<div id="outline-container-org25e3f17" class="outline-2">
<h2 id="org25e3f17"><span class="section-number-2">1.</span> Description</h2>
<div class="outline-text-2" id="text-1">
<p>
A Fenwick Tree is a binary indexed tree that allows efficient:
</p>
<ul class="org-ul">
<li>do range queries from [0, m] like (sum, max, min) in O(log n)</li>
<li>do point updates in O(log n)</li>
</ul>

<p>
Space used is n, the same size as the input range array
Fenwick Tree is using the left most binary bit of node index to represent the range.
For example:
1 in bin is 0001, will keep the range from 1 to 1
3 in bin is 0011, will keep the range from 3 to 3
4 in bin is 0100, will keep the range from 4 to 1
</p>


<p>
<a href="https://youtu.be/uSFzHCZ4E-8">Youtube: Fenwick Tree (Binary Index Tree) Quick Tutorial and Source Code Explanation</a>
</p>

<p>
The Fenwick tree use the left most bit a lot, the followings are some tricks
</p>
<div class="org-src-container">
<pre class="src src-nil">i &amp; -i will give the left most binary bit
i - (i &amp; -i) will remove the left most binary bit
</pre>
</div>
</div>
</div>
<div id="outline-container-org601cccc" class="outline-2">
<h2 id="org601cccc"><span class="section-number-2">2.</span> code</h2>
<div class="outline-text-2" id="text-2">
<p>
template
</p>
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #ECBE7B;">vector</span>&lt;<span style="color: #ECBE7B;">int</span>&gt; <span style="color: #c678dd;">arr</span>(n);
<span style="color: #ECBE7B;">vector</span>&lt;<span style="color: #ECBE7B;">int</span>&gt; <span style="color: #c678dd;">tree</span>(n+<span style="color: #da8548; font-weight: bold;">1</span>) <span style="color: #5B6268;">// </span><span style="color: #5B6268;">tree node start at index 1 not 0</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">Fenwick Tree: update (0 based), increase node n and populate the effect to root</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">update</span>(<span style="color: #ECBE7B;">vector</span>&lt;<span style="color: #ECBE7B;">int</span>&gt;&amp; <span style="color: #dcaeea;">tree</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">node</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">incr</span>) {
  node ++;

  <span style="color: #5B6268;">//</span><span style="color: #5B6268;">populate to the parents</span>
  <span style="color: #51afef;">while</span>(node &lt; tree.size()) {
    tree[node] += incr;
    node += (node &amp; -node);    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">go to the parent by adding the left most binary bit</span>
  }
  <span style="color: #51afef;">return</span>;
}

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">Fenwick Tree: query the range [0, i] (0 based) for the sum</span>
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">query</span>(<span style="color: #ECBE7B;">vector</span>&lt;<span style="color: #ECBE7B;">int</span>&gt;&amp; <span style="color: #dcaeea;">tree</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>) {
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ans</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
  i ++;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">loop through each segment</span>
  <span style="color: #51afef;">while</span>(i&gt;<span style="color: #da8548; font-weight: bold;">0</span>) {
    ans += tree[i];
    i -= (i &amp; -i);
  }

  <span style="color: #51afef;">return</span> ans;
}

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">key idea, add the current node to it's immediate parent</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">build</span>(<span style="color: #ECBE7B;">vector</span>&lt;<span style="color: #ECBE7B;">int</span>&gt;&amp; <span style="color: #dcaeea;">tree</span>, <span style="color: #ECBE7B;">vector</span>&lt;<span style="color: #ECBE7B;">int</span>&gt;&amp; <span style="color: #dcaeea;">arr</span>){
  copy(arr.begin(), arr.end(), tree.begin()+<span style="color: #da8548; font-weight: bold;">1</span>);

  <span style="color: #51afef;">for</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>=<span style="color: #da8548; font-weight: bold;">1</span>; i&lt;tree.size(); i++) {
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">p</span> = i + (i &amp; -i);       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">get the immediate parent</span>
    <span style="color: #51afef;">if</span>(p &lt; tree.size()) {
      tree[p] += tree[i];       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">add to the parent</span>
    }
  }

  <span style="color: #51afef;">return</span>;
}
</pre>
</div>
</div>
</div>
